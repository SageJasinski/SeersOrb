{% extends "base.html" %}

{% block title %}Interaction Graph - Seer's Orb{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1 class="page-title">üï∏Ô∏è Card Interaction Graph</h1>
        <p class="page-subtitle">
            Visualize how cards in your deck interact with each other
        </p>
    </div>

    <div class="graph-layout">
        <!-- Controls -->
        <div class="graph-sidebar">
            <div class="card">
                <h3 class="card-title">Select Deck</h3>
                <select id="deck-select" class="form-select">
                    <option value="">Choose a deck...</option>
                </select>
            </div>

            <div class="card">
                <h3 class="card-title">Filter Interactions</h3>
                <div id="interaction-filters" class="filter-list">
                    <!-- Generated by JS -->
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">Graph Stats</h3>
                <div class="stat-row">
                    <span>Total Nodes</span>
                    <span id="stat-nodes" class="text-accent">0</span>
                </div>
                <div class="stat-row">
                    <span>Total Edges</span>
                    <span id="stat-edges" class="text-accent">0</span>
                </div>
                <div class="stat-row">
                    <span>Density</span>
                    <span id="stat-density" class="text-accent">0%</span>
                </div>
                <div class="stat-row">
                    <span>Components</span>
                    <span id="stat-components" class="text-accent">0</span>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">Key Cards</h3>
                <div id="key-cards-list" class="key-cards-list">
                    <p class="text-muted">Load a deck to see key cards</p>
                </div>
            </div>
        </div>

        <!-- Graph -->
        <div class="graph-main">
            <div class="graph-controls">
                <button class="btn btn-secondary" id="btn-fit">
                    <span>‚äû</span> Fit
                </button>
                <button class="btn btn-secondary" id="btn-center">
                    <span>‚óé</span> Center
                </button>
                <button class="btn btn-secondary" id="btn-layout">
                    <span>üîÑ</span> Re-layout
                </button>

                <div class="layout-select">
                    <select id="layout-algorithm" class="form-select">
                        <option value="cose">Force-Directed</option>
                        <option value="circle">Circle</option>
                        <option value="grid">Grid</option>
                        <option value="concentric">Concentric</option>
                    </select>
                </div>
            </div>

            <div id="graph-container" class="graph-container">
                <div class="graph-placeholder">
                    <span class="placeholder-icon">üï∏Ô∏è</span>
                    <p>Select a deck to visualize interactions</p>
                </div>
            </div>

            <div class="graph-legend">
                <h4>Interaction Types</h4>
                <div id="legend-items" class="legend-items">
                    <!-- Generated by JS -->
                </div>
            </div>
        </div>

        <!-- Card details panel -->
        <div class="card-details-panel hidden" id="card-details">
            <div class="card-details-header">
                <h3 id="detail-card-name">Card Name</h3>
                <button class="btn btn-ghost btn-sm" id="close-details">‚úï</button>
            </div>
            <img id="detail-card-image" src="" alt="Card image">
            <div class="detail-section">
                <h4>Connections</h4>
                <ul id="detail-connections"></ul>
            </div>
            <div class="detail-section">
                <h4>Metrics</h4>
                <div class="stat-row">
                    <span>Degree Centrality</span>
                    <span id="detail-degree">0</span>
                </div>
                <div class="stat-row">
                    <span>Betweenness</span>
                    <span id="detail-betweenness">0</span>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .graph-layout {
        display: grid;
        grid-template-columns: 280px 1fr 280px;
        gap: var(--space-lg);
        min-height: calc(100vh - 200px);
    }

    .graph-sidebar {
        display: flex;
        flex-direction: column;
        gap: var(--space-md);
    }

    .graph-main {
        display: flex;
        flex-direction: column;
    }

    .graph-controls {
        display: flex;
        gap: var(--space-sm);
        margin-bottom: var(--space-md);
    }

    .layout-select {
        margin-left: auto;
    }

    .graph-container {
        flex: 1;
        min-height: 500px;
        background: var(--color-bg-secondary);
        border: 1px solid var(--color-bg-tertiary);
        border-radius: var(--radius-lg);
        position: relative;
    }

    .graph-placeholder {
        position: absolute;
        inset: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: var(--color-text-muted);
    }

    .placeholder-icon {
        font-size: 4rem;
        opacity: 0.3;
        margin-bottom: var(--space-md);
    }

    .graph-legend {
        margin-top: var(--space-md);
        padding: var(--space-md);
        background: var(--color-bg-card);
        border-radius: var(--radius-md);
    }

    .graph-legend h4 {
        font-size: 0.875rem;
        margin-bottom: var(--space-sm);
        color: var(--color-text-muted);
    }

    .legend-items {
        display: flex;
        flex-wrap: wrap;
        gap: var(--space-md);
    }

    .filter-list {
        display: flex;
        flex-direction: column;
        gap: var(--space-xs);
    }

    .filter-item {
        display: flex;
        align-items: center;
        gap: var(--space-sm);
        font-size: 0.875rem;
    }

    .filter-item input {
        accent-color: var(--color-accent);
    }

    .key-cards-list {
        max-height: 200px;
        overflow-y: auto;
    }

    .key-card-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: var(--space-xs) 0;
        font-size: 0.875rem;
        border-bottom: 1px solid var(--color-bg-tertiary);
    }

    .key-card-item:last-child {
        border-bottom: none;
    }

    .card-details-panel {
        background: var(--color-bg-card);
        border: 1px solid var(--color-bg-tertiary);
        border-radius: var(--radius-lg);
        padding: var(--space-md);
        overflow-y: auto;
    }

    .card-details-panel.hidden {
        display: none;
    }

    .card-details-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--space-md);
    }

    .card-details-panel img {
        width: 100%;
        border-radius: var(--radius-md);
        margin-bottom: var(--space-md);
    }

    .detail-section {
        margin-bottom: var(--space-md);
    }

    .detail-section h4 {
        font-size: 0.875rem;
        color: var(--color-text-muted);
        margin-bottom: var(--space-sm);
    }

    .detail-section ul {
        list-style: none;
        font-size: 0.875rem;
    }

    .detail-section li {
        padding: var(--space-xs) 0;
    }
</style>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/graph_viz.js') }}"></script>
{% endblock %}